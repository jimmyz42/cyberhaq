<!DOCTYPE html>
<html>

<head>
    <!-- Libraries -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link href="css/inbox.css" rel="stylesheet" />
    <script src="../inject.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-xs-2 col-sm-3 col-md-2">
                <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                          Mail <span class="caret"></span>
                      </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Mail</a></li>
                        <li><a href="#">Contacts</a></li>
                        <li><a href="#">Tasks</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-10 col-sm-9 col-md-10">
                <!-- Split button -->
                <div class="btn-group">
                    <button type="button" class="btn btn-default" style="height: 34px">
                          <div class="checkbox" style="margin: 0;">
                              <label>
                                  <input type="checkbox">
                              </label>
                          </div>
                      </button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                          <span class="caret"></span><span class="sr-only">Toggle Dropdown</span>
                      </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">All</a></li>
                        <li><a href="#">None</a></li>
                        <li><a href="#">Read</a></li>
                        <li><a href="#">Unread</a></li>
                        <li><a href="#">Starred</a></li>
                        <li><a href="#">Unstarred</a></li>
                    </ul>
                </div>
                <button type="button" class="btn btn-default" data-toggle="tooltip" title="Refresh" id="zmail-refresh">
                      &nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-refresh"></span>&nbsp;&nbsp;&nbsp;</button>
                <!-- Single button -->
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                          More <span class="caret"></span>
                      </button>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="#">Mark all as read</a></li>
                        <li class="divider"></li>
                        <li class="text-center"><small class="text-muted">Select messages to see more actions</small></li>
                    </ul>
                </div>
                <div class="pull-right">
                    <span class="text-muted"><b>1</b>-<b>50</b> of <b>160</b></span>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-default">
                              <span class="glyphicon glyphicon-chevron-left"></span>
                          </button>
                        <button type="button" class="btn btn-default">
                              <span class="glyphicon glyphicon-chevron-right"></span>
                          </button>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-xs-2 col-sm-3 col-md-2">
                <a href="#" class="btn btn-danger btn-sm btn-block" role="button"><i class="glyphicon glyphicon-edit"></i> Compose</a>
                <hr>
                <ul class="nav nav-pills nav-stacked">
                    <li class="inbox-btn active"><a href="#"><span class="badge pull-right">32</span> Inbox </a>
                    </li>
                    <li><a href="#">Starred</a></li>
                    <li><a href="#">Important</a></li>
                    <li><a href="#">Sent Mail</a></li>
                    <li><a href="#"><span class="badge pull-right">3</span>Drafts</a></li>
                </ul>
            </div>
            <div class="col-xs-10 col-sm-9 col-md-10">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#home" data-toggle="tab"><span class="glyphicon glyphicon-inbox">
                      </span>Primary</a></li>
                    <li><a href="#profile" data-toggle="tab"><span class="glyphicon glyphicon-user"></span>
                          Social</a></li>
                    <li><a href="#messages" data-toggle="tab"><span class="glyphicon glyphicon-tags"></span>
                          Promotions</a></li>
                    <!--<li><a href="#settings" data-toggle="tab"><span class="glyphicon glyphicon-plus no-margin">
                      </span></a></li>-->
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="home">
                        <div class="list-group">
                            <!-- reset password html -->
                            <a href="#" class="list-group-item reset-email">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span>
                                <span class="name" style="min-width: 120px; display: inline-block;">Fakebook</span> <span class="inbox subject">Password reset</span><span class="badge">01:08 AM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                      </span>
                                </span>
                                <span style="display:none" class="email-content"></span>
                            </a>
                            <!-- /reset password html -->
                            <a href="#" class="list-group-item">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span>
                                <span class="name" style="min-width: 120px; display: inline-block;">Mark Otto</span> <span class="inbox subject">Nice work on the lastest version</span>
                                <span class="badge">12:10 AM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                      </span></span>
                                <span style="display:none" class="email-content">Hey, I just wanted to let you know that you did a great job working on the latest version of our platform. <br /><br /> Best,<br />Mark</span>
                            </a>

                            <a href="#" class="list-group-item">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span>
                                <span class="name" style="min-width: 120px; display: inline-block;">Jason Markus</span> <span class="inbox subject">Project 4 question</span>
                                <span class="badge">12:09 AM</span>
                                <span class="pull-right">
                                    <span class="glyphicon glyphicon-paperclip">
                                    </span>
                                </span>
                                <span style="display:none" class="email-content">Hey <span class='jack-name'></span>, when will your guys finish the project 4 so that my team can move on with the idea.<br /><br />Thanks,<br />Jason</span>
                            </a>

                            <a href="#" class="list-group-item">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span>
                                <span class="name" style="min-width: 120px; display: inline-block;"><span class="lucy-name"></span></span> <span class="inbox subject">F You</span>
                                <span class="badge">02:13 AM</span>
                                <span class="pull-right">
                                    <span class="glyphicon glyphicon-paperclip">
                                    </span>
                                </span>
                                <span style="display:none" class="email-content">
                                Hey <span class="jack-first-name"></span>,
                                <br><br>
                                You may be a successful multi-millionaire now, but have you forgotten who made you this way in the first place? I supported you and all your life goals. I was the one who found investors to raise money for your pharmaceutical company, Bexley Co. I helped you do all your marketing and found you customers. I even followed you when you were led astray by greed and started using Bexley Co. as a front for manufacturing and selling illegal drugs. I stayed with you through thick and thin, and believe me, I went through some really hard times with you. But what did I get in return? Nothing! You give so much money to charities, but I don't see a cent? What is wrong with you?
                                <br><br>I still have the receipts and records from your illegal drug sales, as well as a list of people who died from overdoses. With this evidence, I could lock you up in jail for life.
                                <br><br>See you in court,
                                <br><span class="lucy-first-name"></span>
                                </span>

                                <span style="display:none" class="email-reply">
                                <span class="reply-from"><span class="jack-name"></span></span>
                                <span class="reply-time">02:17 AM</span>
                                <span class="reply-content">
                                My dearest <span class="lucy-first-name"></span>,
                                <br><br>
                                I'm sorry it had to end this way. Soon after I founded Bexley Co., my mother fell terribly ill. I needed money to pay her medical bills, but Bexley Co. was far from profitable at that point. I had to turn to less legal means of acquiring money. From that point on, I was deeply obsessed with curing diseases and saving lives, so I tried to donate as much as possible to charities that were reasearching cures. I wanted to go legit again, but selling illegal drugs pays a lot more, and I felt that the more money I had, the more good I could do. I was so obsessed with my single-minded mission of eradicating diseases that I forgot about the people I cared about the most. The day you left me was the saddest day of my life. I didn't realize what I had until I lost it. If I could do things over again, I would have treated you a lot better. 
                                <br><br>With sincere apologies,
                                <br><span class="jack-first-name"></span>
                                </span>
                                </span>

                                <span style="display:none" class="email-reply">
                                <span class="reply-from"><span class="lucy-name"></span></span>
                                <span class="reply-time">02:18 AM</span>
                                <span class="reply-content">
                                A tearful apology ain't gonna cut it, <span class="jack-first-name"></span>. I want money not words.
                                <br><br>
                                Although you do make one good point. Bringing you to court might not be the best strategy for me. But I swear, I will get what's rightfully mine if it's the last thing I do.
                                </span>
                                </span>
                            </a>

                            <a href="#" class="list-group-item">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span>
                                <span class="name" style="min-width: 120px; display: inline-block;">Alex Dyson</span>
                                <span class="inbox subject">Thank you for your donation</span>
                                <span class="badge">07:19 AM</span>
                                <span class="pull-right">
                                    <span class="glyphicon glyphicon-paperclip">
                                    </span>
                                </span>
                                <span style="display:none" class="email-content">Dear <span class='jack-name'></span>, 
                                <br><br> Thank you so much for your donation to the International AIDS Foundation. It is only with your continued support that we are able to sustain our life-saving research. You are our single largest donor, and your donations help fund our research into AIDS vaccinations and ultimately, a cure. Below we have attached a receipt of your last donation.
                                <br><br>Bank Name: Galactic Bank
                                <br>Donor Name: <span class='jack-name'></span>
                                <br>Recipient: International AIDS Foundation
                                <br>Account: 21497620
                                <br>Amount: $1,000,000
                                <br><br>
                                Again, thanks for your continued support! Let me know if there's anything we can do for you in the future.
                                <br><br>Sincerely,
                                <br>Alex I. Dyson, Sr.
                                </span>
                            </a>

                        </div>
                    </div>
                    <div class="tab-pane fade in" id="profile">
                        <div class="list-group">

                            <a href="#" class="list-group-item">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span><span class="name" style="min-width: 120px; display: inline-block;">Inder</span> <span class="inbox subject">You have a new match on Inder!</span>
                                <span class="badge">06:09 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                <span style="display:none" class="email-content">
                                  <h2>Kitty Kat</h2>
                                  <img class="full" src="https://static.pexels.com/photos/104827/cat-pet-animal-domestic-104827.jpeg"></img>
                                  <p>I'm all pussy &#128049;</p>
                                  <p>&#128049; Call me at (666) 999-6969</p>
                                  <br>
                                  <p>&#9400; Inder Inc</p>
                                </span>
                            </a>

                            <a href="#" class="list-group-item read phishing-email">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span><span class="name" style="min-width: 120px; display: inline-block;"></span> <span class="inbox subject"></span>
                                <span class="badge">04:20 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                <span style="display:none" class="email-content"></span>
                            </a>

                            <a href="#" class="list-group-item read">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span><span class="name" style="min-width: 120px; display: inline-block;">Fakebook</span> <span class="inbox subject">You've got new friend request</span>
                                <span class="badge">11:30 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                <span style="display:none" class="email-content">Bruce Wayne wants to add you to his friends. <br /><br />Log in to Fakebook to confirm (or decline). <br /><br /> <p>&#9400; Fakebook Inc</p></span>
                            </a>

                            <a href="#" class="list-group-item read">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star"></span><span class="name" style="min-width: 120px; display: inline-block;">LinkedOn</span> <span class="inbox subject">Alireza: No-kia Networks and System Group</span>
                                <span class="badge">10:32 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                                      </span></span>
                                <span style="display:none" class="email-content">Alireza: No-kia Networks and System Group offers great deals on their platform. <br />Log in to your LinkedOn to check it out. <br /><br /><p>&#9400; LinkedOn Inc</p></span>
                            </a>
                            <a href="#" class="list-group-item read">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star-empty"></span><span class="name" style="min-width: 120px; display: inline-block;">Switter</span> <span class="inbox subject">Your Switter password has been changed</span>
                                <span class="badge">08:48 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                                      </span></span>
                                <span style="display:none" class="email-content">Log in to your Switter account to confirm this change <br /><br /> <p>&#9400; Switter Inc</p></span>
                            </a>

                        </div>
                    </div>
                    <div class="tab-pane fade in" id="messages">
                        <div class="list-group">

                            <a href="#" class="list-group-item read">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star"></span><span class="name" style="min-width: 120px; display: inline-block;">Tim Reid, S P N</span> <span class="inbox subject">Boost Your Website Traffic</span>
                                <span class="badge">05:21 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip"></span></span>
                                <span style="display:none" class="email-content">Boost Your Website Traffic using our newest data analytics software<br /><br />Best,<br /><br />Tim Reid</span>
                            </a>

                            <a href="#" class="list-group-item read">
                                <div class="checkbox">
                                    <label><input type="checkbox"></label>
                                </div>
                                <span class="glyphicon glyphicon-star"></span><span class="name" style="min-width: 120px; display: inline-block;">Anne Hunter</span> <span class="inbox subject">[EECS-jobs-announce] Full-Time Software Engineers</span>
                                <span class="badge">05:08 PM</span> <span class="pull-right"><span class="glyphicon glyphicon-paperclip">
                                                      </span></span>
                                <span style="display:none" class="email-content">Covert Lab, Stanford. This position is an opportunity to contribute to one of the most exciting new frontiers of computational biology. Specifically, the creation of a whole-cell computer model that explicitly takes all of the known information about each gene and molecule into account to predict cell behaviors was called an ultimate goal of biology, and a grand challenge for the 21st century. The Covert Lab reported completion of the first such model in 2012, an achievement that was recently highlighted in the journal Cell as one of the most important advances reported by that journal in its entire 40-year existence.<br /><br /><hr>EECS-jobs-announce mailing list</span>
                            </a>

                        </div>
                    </div>
                </div>

                <div class="row-md-12">

                    <div class="well">
                        <p style="color:#808080;">
                            	&#9400; 2017 zmail
                        </p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT -->
    <script>
        // indices of emails that need to be set to read
        if(window.sessionStorage.getItem('readEmails') === null) {
          window.sessionStorage.setItem('readEmails', JSON.stringify([]));
        }
        var readEmails = JSON.parse(window.sessionStorage.getItem('readEmails'));
        for(var i=0;i<readEmails.length;i++) {
          $("a.list-group-item").eq(readEmails[i]).addClass('read');
        }

        $(document).ready(function() {
            // email has already been cracked , save it
            window.sessionStorage.setItem("solvedMail", "true");

            // fakebook password reset sent or not
            if (window.sessionStorage.getItem("resetEmailSent") == "true") {
                console.log(window.sessionStorage.getItem("resetEmailSent"));
                $(".reset-email").show();
            } else {
                $(".reset-email").hide();
            }

            //inject phishing email content
            var phishingData = JSON.parse(window.sessionStorage.getItem('phishingEmailData'));
            $('.phishing-email .name').html(phishingData.name);
            $('.phishing-email .subject').html(phishingData.subject);
            $('.phishing-email .email-content').html('<img class="full" src="' + phishingData.image + '"></img>');
            // make sure tab is right
            $('.nav-tabs a').on('shown.bs.tab', function(e) {
              window.sessionStorage.setItem('zmail-tab-id', $(this).attr('href'));
            });
            var curTabId = window.sessionStorage.getItem('zmail-tab-id') || '#home';
            $('.nav-tabs a[href="#home"]').parent().removeClass('active');
            $('.nav-tabs a[href="' + curTabId + '"]').parent().addClass('active');
            $('#home').removeClass('active');
            $(curTabId).addClass('active');

            // handling opening email
            $("a.list-group-item").click(function(event) {
                var myIndex = $("a.list-group-item").index($(this));
                if(readEmails.indexOf(myIndex) == -1) readEmails.push(myIndex);
                window.sessionStorage.setItem('readEmails', JSON.stringify(readEmails));

                event.preventDefault();
                var name = $(this).find(".name").html();
                var subject = $(this).find(".subject").html();
                var emailContent = $(this).find(".email-content").html();
                var emailTime = $(this).find(".badge").html();
                var emailReplies = $(this).find('.email-reply').map(function() {
                  return {
                    content: $(this).find('.reply-content').html(),
                    from: $(this).find('.reply-from').html(),
                    time: $(this).find('.reply-time').html(),
                  };
                }).get();       
                var zmailContent = {
                  name: name,
                  subject: subject,
                  content: emailContent,
                  replies: emailReplies,
                  time: emailTime,
                };

                if ($(this).attr('class').includes("reset-email")) {
                    zmailContent.reset = true;
                }
                window.sessionStorage.setItem("zmailContent", JSON.stringify(zmailContent));
                window.location.href = "email-detail.html";
            });

            $('#zmail-refresh, .inbox-btn').click(function() {
                location.reload();
            });
        });
    </script>
</body>

</html>
